---
title: 手写一个脚手架
date: 2021-07-28 21:43:06
tags 
  - Node
  - Npm
---


## 创建项目

```shell
mkdir mingle-cli

cd mingle-cli

npm init -y

npm install commander download-git-repo ora handlebars figlet clear chanlk open -s
```



- command 
- download-git-repo
- ora
- handlebars
- figlet
- clear
- chanlk
- open





## 配置目录结构



```shell
mkdir bin 

cd bin && touch mingle.js
```



目录结构如下：

```
mingle-cli
├── bin
│   └── mingle.js
├── node_modules
├── package-lock.json
└── package.json
```





## 配置package.json

package.json中配置bin

```
  {
    "name": "mingle-cli",
    "version": "1.0.0",
    "description": "",
    "main": "mingle.js",
    "scripts": {
      "test": "echo \"Error: no test specified\" && exit 1"
    },
+   "bin": {
+     "mingle": "./bin/mingle.js"
+   },
    "keywords": [],
    "author": "",
    "license": "ISC",
    "dependencies": {
      "commander": "^8.1.0"
    }
  }

```



## 编写 minglejs

```javascript
#!/usr/bin/env node		// 声明用node解析该文件

const { program } = require('commander');

program.version(require('../package.json').version);

program
    .command('new <name>')
    .description('new project')
    .action(require('../lib/new'));

console.log(process.argv);

program.parse(process.argv);

```





## 配置全局命令

```shell
sudo npm link
```



执行成功后，可以使用 ` mingle ` 这个全局命令了.



<img src="http://cdn.chrischen.top/blog/l7e86J.png" style="zoom:67%;" />





## 完善代码

lib/new.js

```javascript
const { promisify } = require('util');
const figlet = promisify(require('figlet'));
const clear = require('clear');
const chalk = require('chalk');
const log = content => console.log(chalk.green(content));
const { clone } = require('./download');

module.exports = async name => {
    // clear();
    const data = await figlet('MINGLE');
    log(data);
    
    log(`🚗 创建项目 ${ name }`);
    await clone('https://github.com/ImChrisChen/blog.chrisorz.cn#master');
};
```





lib/download.js

```javascript
/**
 * Created by WebStorm.
 * User: chrischen
 * Date: 2021/7/28
 * Time: 22:14
 */

const { promisify } = require('util');
const ora = require('ora');
const download = promisify(require('download-git-repo'));

module.exports.clone = async function (repo, desc) {
    // const spinner = ora(`🏄🏼 下载... ${ repo }`).start();
    // console.log(spinner);
    // spinner.start();
    
    await download(repo, desc);
    console.log('下载完成');
};
```



bin/mingle.js

```javascript
#!/usr/bin/env node

const { program } = require('commander');

program.version(require('../package.json').version);

program
    .command('new <name>')
    .description('new project')
    .action(require('../lib/new'));

console.log(process.argv);

program.parse(process.argv);
```



创建一个基于mingle的脚手架项目

```javascript
mingle new mingle-cli
```



